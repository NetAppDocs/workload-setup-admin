---
sidebar: sidebar
permalink: permissions-reference.html
keywords: permissions, actions
summary: To use Workload Factory features and services, you'll need to provide permissions so that Workload Factory can perform operations in your cloud environment. 
---

= Permissions for Workload Factory
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
To use Workload Factory features and services, you'll need to provide permissions so that Workload Factory can perform operations in your cloud environment. 

== Why use permissions
When you provide read or automate mode permissions, Workload Factory attaches a policy to the instance with permissions to manage resources and processes within that AWS account. This allows Workload Factory to execute various operations starting from discovery of your storage environments to deploying AWS resources such as file systems in storage management or knowledge bases for GenAI workloads. 

For database workloads for example, when Workload Factory is granted with the required permissions, it scans all EC2 instances in a given account and region, and filters all Windows-based machines. If SSM is installed and running on the host and System Manager networking is configured properly, Workload Factory can access the Windows machine and verify whether SQL Server software is installed or not.

== IAM policies
The IAM policies available below provide the permissions that Workload Factory needs to manage resources and processes within your public cloud environment based on the operational mode you operate in.

Select your operational mode to view the required policies:

[role="tabbed-block"]
=====
.Read mode
--
[source,json]
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "CommonGroup",
      "Effect": "Allow",
      "Action": [
        "cloudwatch:GetMetricStatistics",
        "sns:ListTopics",
        "ec2:DescribeInstances",
        "ec2:DescribeVpcs",
        "ec2:DescribeSubnets",
        "ec2:DescribeSecurityGroups",
        "ec2:DescribeImages",
        "ec2:DescribeRegions",
        "ec2:DescribeRouteTables",
        "ec2:DescribeKeyPairs",
        "ec2:DescribeNetworkInterfaces",
        "ec2:DescribeInstanceTypes",
        "ec2:DescribeVpcEndpoints",
        "ec2:DescribeInstanceTypeOfferings",
        "ec2:DescribeSnapshots",
        "ec2:DescribeVolumes",
        "kms:ListAliases",
        "kms:ListKeys",
        "kms:DescribeKey",
        "cloudformation:ListStacks",
        "ds:DescribeDirectories",
        "fsx:DescribeVolumes",
        "fsx:DescribeBackups",
        "fsx:DescribeStorageVirtualMachines",
        "fsx:DescribeFileSystems",
        "servicequotas:ListServiceQuotas",
        "ssm:GetParametersByPath",
        "ssm:GetCommandInvocation",
        "ssm:SendCommand",
        "ssm:GetConnectionStatus",
        "fsx:ListTagsForResource"
      ],
      "Resource": [
        "*"
      ]
    },
    {
      "Sid": "SSMParameterStore",
      "Effect": "Allow",
      "Action": [
        "ssm:GetParameter",
        "ssm:GetParameters",
        "ssm:PutParameter",
        "ssm:DeleteParameters"
      ],
      "Resource": "arn:aws:ssm:*:*:parameter/netapp/wlmdb/*"
    }
  ]
}

--
.Automate mode
--
[source,json]
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "EC2Group",
      "Effect": "Allow",
      "Action": [
        "ec2:AllocateAddress",
        "ec2:AllocateHosts",
        "ec2:AssignPrivateIpAddresses",
        "ec2:AssociateAddress",
        "ec2:AssociateRouteTable",
        "ec2:AssociateSubnetCidrBlock",
        "ec2:AssociateVpcCidrBlock",
        "ec2:AttachInternetGateway",
        "ec2:AttachNetworkInterface",
        "ec2:AttachVolume",
        "ec2:AuthorizeSecurityGroupEgress",
        "ec2:AuthorizeSecurityGroupIngress",
        "ec2:CreateVolume",
        "ec2:DeleteNetworkInterface",
        "ec2:DeleteSecurityGroup",
        "ec2:DeleteTags",
        "ec2:DeleteVolume",
        "ec2:DetachNetworkInterface",
        "ec2:DetachVolume",
        "ec2:DisassociateAddress",
        "ec2:DisassociateIamInstanceProfile",
        "ec2:DisassociateRouteTable",
        "ec2:DisassociateSubnetCidrBlock",
        "ec2:DisassociateVpcCidrBlock",
        "ec2:ModifyInstanceAttribute",
        "ec2:ModifyInstancePlacement",
        "ec2:ModifyNetworkInterfaceAttribute",
        "ec2:ModifySubnetAttribute",
        "ec2:ModifyVolume",
        "ec2:ModifyVolumeAttribute",
        "ec2:ReleaseAddress",
        "ec2:ReplaceRoute",
        "ec2:ReplaceRouteTableAssociation",
        "ec2:RevokeSecurityGroupEgress",
        "ec2:RevokeSecurityGroupIngress",
        "ec2:StartInstances",
        "ec2:StopInstances"
      ],
      "Resource": "*",
      "Condition": {
        "StringLike": {
          "ec2:ResourceTag/aws:cloudformation:stack-name": "WLMDB*"
        }
      }
    },
    {
      "Sid": "FSxNGroup",
      "Effect": "Allow",
      "Action": [
        "fsx:TagResource"
      ],
      "Resource": "*",
      "Condition": {
        "StringLike": {
          "aws:ResourceTag/aws:cloudformation:stack-name": "WLMDB*"
        }
      }
    },
    {
      "Sid": "CommonGroup",
      "Effect": "Allow",
      "Action": [
        "cloudformation:CreateStack",
        "cloudformation:DescribeStackEvents",
        "cloudformation:DescribeStacks",
        "cloudformation:ListStacks",
        "cloudformation:ValidateTemplate",
        "cloudwatch:GetMetricStatistics",
        "ds:DescribeDirectories",
        "ec2:CreateLaunchTemplate",
        "ec2:CreateLaunchTemplateVersion",
        "ec2:CreateNetworkInterface",
        "ec2:CreateSecurityGroup",
        "ec2:CreateTags",
        "ec2:CreateVpcEndpoint",
        "ec2:Describe*",
        "ec2:Get*",
        "ec2:RunInstances",
        "ec2:ModifyVpcAttribute",
        "ec2messages:*",
        "fsx:CreateFileSystem",
        "fsx:CreateStorageVirtualMachine",
        "fsx:CreateVolume",
        "fsx:Describe*",
        "fsx:List*",
        "kms:CreateGrant",
        "kms:Describe*",
        "kms:List*",
        "kms:GenerateDataKey",
        "kms:Decrypt",
        "logs:CreateLogGroup",
        "logs:CreateLogStream",
        "logs:DescribeLog*",
        "logs:GetLog*",
        "logs:ListLogDeliveries",
        "logs:PutLogEvents",
        "logs:TagResource",
        "servicequotas:ListServiceQuotas",
        "sns:ListTopics",
        "sns:Publish",
        "ssm:Describe*",
        "ssm:Get*",
        "ssm:List*",
        "ssm:PutComplianceItems",
        "ssm:PutConfigurePackageResult",
        "ssm:PutInventory",
        "ssm:SendCommand",
        "ssm:UpdateAssociationStatus",
        "ssm:UpdateInstanceAssociationStatus",
        "ssm:UpdateInstanceInformation",
        "ssmmessages:*"
      ],
      "Resource": "*"
    },
    {
      "Sid": "ArnGroup",
      "Effect": "Allow",
      "Action": [
        "cloudformation:SignalResource"
      ],
      "Resource": [
        "arn:aws:cloudformation:*:*:stack/WLMDB*",
        "arn:aws:logs:*:*:log-group:WLMDB*"
      ]
    },
    {
      "Sid": "IAMGroup",
      "Effect": "Allow",
      "Action": [
        "iam:AddRoleToInstanceProfile",
        "iam:CreateInstanceProfile",
        "iam:CreateRole",
        "iam:DeleteInstanceProfile",
        "iam:GetPolicy",
        "iam:GetPolicyVersion",
        "iam:GetRole",
        "iam:GetRolePolicy",
        "iam:GetUser",
        "iam:PutRolePolicy",
        "iam:RemoveRoleFromInstanceProfile",
        "iam:SimulatePrincipalPolicy"
      ],
      "Resource": "*"
    },
    {
      "Sid": "IAMGroup1",
      "Effect": "Allow",
      "Action": "iam:CreateServiceLinkedRole",
      "Resource": "*",
      "Condition": {
        "StringLike": {
          "iam:AWSServiceName": "ec2.amazonaws.com"
        }
      }
    },
    {
      "Sid": "IAMGroup2",
      "Effect": "Allow",
      "Action": "iam:PassRole",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "iam:PassedToService": "ec2.amazonaws.com"
        }
      }
    },
    {
      "Sid": "SSMParameterStore",
      "Effect": "Allow",
      "Action": [
        "ssm:GetParameter",
        "ssm:GetParameters",
        "ssm:PutParameter",
        "ssm:DeleteParameters"
      ],
      "Resource": "arn:aws:ssm:*:*:parameter/netapp/wlmdb/*"
    }
  ]
}
--
=====
// end tabbed area

== Permissions by workload
Each workload uses permissions to perform certain tasks in Workload Factory. Scroll to the workload you use to view the list of permissions, their purpose, where they are used, and which modes support them. 

=== Permissions for storage workloads

No input

=== Permissions for database workloads
The following table displays the permissions for database workloads. 

.Table of permissions for database workloads
[%collapsible]
====
[cols=5*,options="header"]
|===

| Purpose
| Action
| Where used
| Read mode
| Automate mode

| Get metric statistics for FSx for ONTAP, EBS, and FSx for Windows File Server
| cloudwatch:GetMetricStatistics | Inventory (Detection) and explore savings | Yes | Yes

| List and set triggers for events 
| sns:ListTopics | Deployment | Yes | Yes

.4+| Get details for EC2 instances 
| ec2:DescribeInstances | Inventory (Detection) and explore savings | Yes | Yes
| ec2:DescribeKeyPairs | Deployment | Yes | Yes
| ec2:DescribeNetworkInterfaces | Deployment | Yes | Yes
| ec2:DescribeInstanceTypes | Deployment and explore savings | Yes | Yes

.6+| Get details to fill in the FSx for ONTAP deployment form
| ec2:DescribeVpcs | Deployment and Inventory (Detection) | Yes | Yes
| ec2:DescribeSubnets | Deployment and Inventory (Detection) | Yes | Yes
| ec2:DescribeSecurityGroups | Deployment | Yes | Yes
| ec2:DescribeImages | Deployment | Yes | Yes
| ec2:DescribeRegions | Deployment | Yes | Yes
| ec2:DescribeRouteTables | Deployment and Inventory (Detection) | Yes | Yes

| Get any existing VPC endpoints to determine if new endpoints need to be created before deployments
| ec2:DescribeVpcEndpoints | Deployment and Inventory (Detection) | Yes | Yes

| Get instance types available in region for validation nodes (t2.micro/t3.micro) 
| ec2:DescribeInstanceTypeOfferings | Deployment | Yes | Yes

| Get snapshot details of each attached EBS volumes for pricing and savings estimate
| ec2:DescribeSnapshots | Explore savings | Yes | Yes

| Get details of each attached EBS volumes for pricing and savings estimate
| ec2:DescribeVolumes | Inventory (Detection) and Explore savings | Yes | Yes

.3+| Get KMS key details for FSx for ONTAP file system encryption
| kms:ListAliases | Deployment | Yes | Yes
| kms:ListKeys | Deployment | Yes | Yes
| kms:DescribeKey | Deployment | Yes | Yes

| Get list of CloudFormation stacks running in the environment to check quota limit
| cloudformation:ListStacks | Deployment | Yes | Yes

| Get list of AWS-managed Active Directories in the region
| ds:DescribeDirectories | Deployment | Yes | Yes

.5+| Get lists and details of volumes, backups, SVMs, file systems in AZs, and tags for FSx for ONTAP file system
| fsx:DescribeVolumes | Inventory(Detection) and Explore Savings | Yes | Yes
| fsx:DescribeBackups | Inventory(Detection) and Explore Savings | Yes | Yes
| fsx:DescribeStorageVirtualMachines | Deployment, Manage operations, and Inventory (Detection) | Yes | Yes
| fsx:DescribeFileSystems | Deployment, Manage operations, Inventory (Detection), and Explore savings | Yes | Yes
| fsx:ListTagsForResource | Manage operations | Yes | Yes

| Get service quota limits for CloudFormation and VPC
| servicequotas:ListServiceQuotas | Deployment | Yes | Yes

| Use SSM-based query to get the updated list of FSx for ONTAP supported regions
| ssm:GetParametersByPath | Deployment | Yes | Yes

| Poll for SSM response after sending command for manage operations post deployment
| ssm:GetCommandInvocation | Manage operations, Inventory (Detection), and Explore savings | Yes | Yes

| Send commands over SSM to EC2 instances 
| ssm:SendCommand | Manage operations, Inventory (Detection), and Explore savings | Yes | Yes

| Get the SSM connectivity status on instances post deployment
| ssm:GetConnectionStatus |  Manage operations and Inventory (Detection) | Yes | Yes

.4+| Get, list, create, and delete SSM parameters for AD, FSx for ONTAP, and SQL user credentials used during deployment or managed in your AWS account
| ssm:GetParameter ^1^ | Deployment and manage operations | Yes | Yes
| ssm:GetParameters ^1^ | Manage operations | Yes | Yes
| ssm:PutParameter ^1^ | Deployment and manage operations | Yes | Yes
| ssm:DeleteParameters ^1^ | Manage operations | Yes | Yes

.9+| Associate network resources to SQL nodes and validation nodes, and add additional secondary IPs to SQL nodes
| ec2:AllocateAddress ^1^ | Deployment | No | Yes
| ec2:AllocateHosts  ^1^ | Deployment | No | Yes
| ec2:AssignPrivateIpAddresses ^1^ | Deployment | No | Yes
| ec2:AssociateAddress ^1^ | Deployment | No | Yes
| ec2:AssociateRouteTable ^1^ | Deployment | No | Yes
| ec2:AssociateSubnetCidrBlock ^1^ | Deployment | No | Yes
| ec2:AssociateVpcCidrBlock ^1^ | Deployment | No | Yes
| ec2:AttachInternetGateway ^1^ | Deployment | No | Yes
| ec2:AttachNetworkInterface ^1^ | Deployment | No | Yes

| Attach EBS volumes required to the SQL nodes for deployment
| ec2:AttachVolume |  Deployment | No | Yes

.2+| Attach security groups and modify rules for the provisioned nodes
| ec2:AuthorizeSecurityGroupEgress | Deployment | No | Yes
| ec2:AuthorizeSecurityGroupIngress | Deployment | No | Yes

| Create EBS volumes required to the SQL nodes for deployment
| ec2:CreateVolume |  Deployment | No | Yes

.11+| Remove the temporary validation nodes created of type t2.micro and for rollback or retry of failed EC2 SQL nodes
| ec2:DeleteNetworkInterface | Deployment | No | Yes
| ec2:DeleteSecurityGroup | Deployment | No | Yes
| ec2:DeleteTags | Deployment | No | Yes
| ec2:DeleteVolume | Deployment | No | Yes
| ec2:DetachNetworkInterface | Deployment | No | Yes
| ec2:DetachVolume | Deployment | No | Yes
| ec2:DisassociateAddress | Deployment | No | Yes
| ec2:DisassociateIamInstanceProfile | Deployment | No | Yes
| ec2:DisassociateRouteTable | Deployment | No | Yes
| ec2:DisassociateSubnetCidrBlock | Deployment | No | Yes
| ec2:DisassociateVpcCidrBlock | Deployment | No | Yes

.7+| Modify attributes for created SQL instances. Only applicable to names that start with WLMDB.
| ec2:ModifyInstanceAttribute | Deployment | No | Yes
| ec2:ModifyInstancePlacement | Deployment | No | Yes
| ec2:ModifyNetworkInterfaceAttribute | Deployment | No | Yes
| ec2:ModifySubnetAttribute | Deployment | No | Yes
| ec2:ModifyVolume | Deployment | No | Yes
| ec2:ModifyVolumeAttribute | Deployment | No | Yes
| ec2:ModifyVpcAttribute | Deployment | No | Yes

.5+| Disassociate and destroy validation instances
| ec2:ReleaseAddress | Deployment | No | Yes
| ec2:ReplaceRoute | Deployment | No | Yes
| ec2:ReplaceRouteTableAssociation | Deployment | No | Yes
| ec2:RevokeSecurityGroupEgress | Deployment | No | Yes
| ec2:RevokeSecurityGroupIngress | Deployment | No | Yes

| Start the deployed instances
| ec2:StartInstances |  Deployment | No | Yes

| Stop the deployed instances
| ec2:StopInstances |  Deployment | No | Yes

| Tag custom values for FSxN resources created by WLMDB to get billing details during resource management
| fsx:TagResource ^1^ | Deployment and Manage operations | No | Yes

.5+| Create and validate CloudFormation template for deployment
| cloudformation:CreateStack | Deployment | No | Yes
| cloudformation:DescribeStackEvents | Deployment | No | Yes
| cloudformation:DescribeStacks | Deployment | No | Yes
| cloudformation:ListStacks | Deployment | No | Yes
| cloudformation:ValidateTemplate | Deployment | No | Yes

| Fetch metrics for compute optimization recommendation
| cloudwatch:GetMetricStatistics | Explore savings | No | Yes

| Fetch directories available in the region
| ds:DescribeDirectories | Deployment | No | Yes

.2+| Add rules for the Security Group attached to provisioned EC2 instances
| ec2:AuthorizeSecurityGroupEgress | Deployment | No | Yes
| ec2:AuthorizeSecurityGroupIngress | Deployment | No | Yes
Question: Can this one and Attach security groups and modify rules for the provisioned nodes be combined? Same permissions.

.2+| Create nested stack templates for retry and rollback
| ec2:CreateLaunchTemplate | Deployment | No | Yes
| ec2:CreateLaunchTemplateVersion | Deployment | No | Yes

.3+| Manage tags and network security on created instances
| ec2:CreateNetworkInterface | Deployment | No | Yes
| ec2:CreateSecurityGroup | Deployment | No | Yes
| ec2:CreateTags | Deployment | No | Yes

| Delete SecurityGroup created temporarily for validation nodes
| ec2:DeleteSecurityGroup | Deployment | No | Yes

.2+| Get instance details for provisioning
| ec2:Describe* | Deployment, Inventory (Detection), and Explore savings | No | Yes
| ec2:Get* | Deployment, Inventory (Detection), and Explore savings | No | Yes

| Start the created instances
| ec2:RunInstances | Deployment | No | Yes

//.2+| Update and remove rules from security groups created during provisioning
//| ec2:RevokeSecurityGroupEgress | ? | No | Yes
//| ec2:RevokeSecurityGroupIngress | ? | No | Yes

| Systems Manager uses AWS message delivery service endpoint for API operations
| ec2messages:* | Deployment and inventory (Detection) | No | Yes

.3+| Create FSx for ONTAP resources required for provisioning. For existing FSx for ONTAP systems, a new SVM is created to host SQL volumes.
| fsx:CreateFileSystem | Deployment | No | Yes
| fsx:CreateStorageVirtualMachine | Deployment| No | Yes
| fsx:CreateVolume | Deployment and manage operations | No | Yes

.2+| Get FSx for ONTAP details
| fsx:Describe* | Deployment, inventory (detection), manage operations, and explore savings | No | Yes
| fsx:List* | Deployment and inventory (detection) | No | Yes

.4+| Get KMS key details and use for FSx for ONTAP encryption
| kms:CreateGrant | Deployment | No | Yes
| kms:Describe* | Deployment | No | Yes
| kms:List* | Deployment | No | Yes
| kms:GenerateDataKey | Deployment | No | Yes

.7+| Create CloudWatch logs for validation and provisioning scripts running on EC2 instances
| logs:CreateLogGroup | Deployment | No | Yes
| logs:CreateLogStream | Deployment | No | Yes
| logs:DescribeLog* | Deployment | No | Yes
| logs:GetLog* | Deployment | No | Yes
| logs:ListLogDeliveries | Deployment | No | Yes
| logs:PutLogEvents | Deployment and manage operations | No | Yes
| logs:TagResource| Deployment | No | Yes

| Create secrets in a user account for the credentials provided for SQL, domain, and FSx for ONTAP
| servicequotas:ListServiceQuotas | Deployment | No | Yes

.2+| List customer SNS topics and publish to WLMDB backend SNS as well as customer SNS if selected
| sns:ListTopics | Deployment | No | Yes
| sns:Publish | Deployment | No | Yes

.11+| Required SSM permissions to run the discovery script on provisioned SQL instances and to fetch latest list of FSx for ONTAP supported AWS regions.
| ssm:Describe* | Deployment | No | Yes
| ssm:Get* | Deployment and manage operations | No | Yes
| ssm:List* | Deployment | No | Yes
| ssm:PutComplianceItems | Deployment | No | Yes
| ssm:PutConfigurePackageResult | Deployment | No | Yes
| ssm:PutInventory | Deployment | No | Yes
| ssm:SendCommand | Deployment, inventory (detection), and manage operations | No | Yes
| ssm:UpdateAssociationStatus | Deployment | No | Yes
| ssm:UpdateInstanceAssociationStatus | Deployment | No | Yes
| ssm:UpdateInstanceInformation | Deployment | No | Yes
| ssmmessages:* | Deployment, inventory (detection), and manage operations | No | Yes

| Signal CloudFormation stack on success or failure. 
| cloudformation:SignalResource ^1^ | Deployment | No | Yes

| Add EC2 role created by template to the instance profile of EC2 to allow scripts on EC2 to access the required resources for deployment.
| iam:AddRoleToInstanceProfile | Deployment | No | Yes

| Create instance profile for EC2 and attach the created EC2 role.
| iam:CreateInstanceProfile | Deployment | No | Yes

| Create EC2 role through template with permissions listed below - *Questions: Which permissions? And what about this note - "Need to add condition to allow to a group and allow role to be used only as part of service(EC2 instance profile)"*
| iam:CreateRole | Deployment | No | Yes

| Create role linked to EC2 service *Question - Do we need to add "iam:CreateServiceLinkedRole limited by

iam:AWSServiceName": "ec2.amazonaws.com"*
| iam:CreateServiceLinkedRole | Deployment | No | Yes

| Delete instance profile created during deployment specifically for the validation nodes
| iam:DeleteInstanceProfile | Deployment | No | Yes

.5+| Get the role and policy details to determine any gaps in permission and validate for deployment
| iam:GetPolicy | Deployment | No | Yes
| iam:GetPolicyVersion | Deployment | No | Yes
| iam:GetRole | Deployment | No | Yes
| iam:GetRolePolicy | Deployment | No | Yes
| iam:GetUser | Deployment | No | Yes

| Pass the role created to EC2 instance  *Question about note: "iam:PassRole limited by "iam:PassedToService": "ec2.amazonaws.com""*
| iam:PassRole | Deployment | No | Yes

| Add policy with required permissions to the EC2 role created
| iam:PutRolePolicy | Deployment | No | Yes

| Detach role from the provisioned EC2 instance profile
| iam:RemoveRoleFromInstanceProfile | Deployment | No | Yes

| Validate permissions available in the role and compare with required permissions
| iam:SimulatePrincipalPolicy | Deployment | No | Yes

.4+| Save credentials for FSx for ONTAP, Active Directory, and SQL user (only for SQL user authentication)
| ssm:GetParameter ^1^ | Deployment, inventory (detection), and manage operations | No | Yes
| ssm:GetParameters ^1^ | Deployment and inventory (detection) | No | Yes
| ssm:PutParameter^1^ | Deployment and manage operations | No | Yes
| ssm:DeleteParameters ^1^ | Deployment and manage operations | No | Yes

|===
. Permission is restricted to resources starting with WLMDB.
====

=== Permissions for GenAI workloads

The following table displays the permissions for database workloads. 

.Table of permissions for database workloads
[%collapsible]
====
[cols=4*,options="header"]
|===

| Purpose
| Action
| Where used
| Role

| To create AI engine cloudformation stack on deploy and rebuild operations
| cloudformation:CreateStack
| Deployment
| Operate

| To create AI engine cloudformation stack
| cloudformation:DescribeStacks
| Deployment
| Operate

| To list all region on the ai-engine deployment wizard
| cloudformation:DescribeStacks
| Deployment
| Operate

| List ai-engine tags to show on the ui
| cloudformation:DescribeStacks
| 
| Operate

| To list vpc endpoints before ai-engine stack creation to see if we need to create
| cloudformation:DescribeStacks
| 
| Operate

| Create ai-engine security group during the ai-engine stack creation ( on deploy and rebuild operations)
| cloudformation:DescribeStacks
| Deployment
| Operate

| Allow to tag resources that were created by ai-engine stack creation ( security group, instance ) (on deploy and rebuild operations)
| cloudformation:DescribeStacks
| Deployment
| Operate

| To list vpcs on the ai-engine deployment aizard
| cloudformation:DescribeStacks
| Deployment
| Operate

| List route tables in order to add them to the s3 gateway private endpoint  we create during the ai-engine deployment and rebuild
| cloudformation:DescribeStacks
| Deployment
| Operate

| To List  key-pairs on the ai-engine deployment wizard
| cloudformation:DescribeStacks
| Deployment
| Operate

| List security groups during ai-engine stack creation ( to find security groups on the private endpoints)
| cloudformation:DescribeStacks
| Deployment
| Operate

| List vpc-endpoints in order to find which vpc endpoints should be created during the ai-engine deployment
| cloudformation:DescribeStacks
| Deployment
| Operate

| List instances to find out the ai-engine state
| cloudformation:DescribeStacks
| 
| Operate

| To list the images during the ai-engine stack creation on deploy and rebuild operations
| cloudformation:DescribeStacks
| Deployment
| Operate

.2+| To create and update ai-instance and private endpoints security group during the ai-instace stack creation (on deploy and rebuild operations) 
| ec2:RevokeSecurityGroupEgress | Deployment | Operate
| ec2:RevokeSecurityGroupIngress | Deployment | Operate

| Run ai-engine during cloudformation stack creation (on deploy and rebuild operations)
| cloudformation:DescribeStacks
| Deployment
| Operate

.2+| Aattach security group and modify rules for the ai-engine during stack creation (on deploy and rebuild operations)
| ec2:AuthorizeSecurityGroupEgress | Deployment | Operate
| ec2:AuthorizeSecurityGroupIngress | Deployment | Operate

| To understand if bedrock cloudwatch logging is enabled during ai-engine deployment
| cloudformation:DescribeStacks
| Deployment
| Operate

| To initiate chat request to one of the foundation models
| cloudformation:DescribeStacks
| 
| Operate

| To initiate chat/embedding request to one of the foundation models
| cloudformation:DescribeStacks
| 
| Operate

| To show the available foundation models in a region
| cloudformation:DescribeStacks
| 
| Operate

| To find regions that support fsx and bedrock during the ai-engine wizard
| cloudformation:DescribeStacks
| Deployment
| Operate

| To find the latest amazon linux 2023 image for the ai-engine deployment ( on deploy and rebuild operations ) 
| cloudformation:DescribeStacks
| Deployment
| Operate

| ssm messages permissions are required to send commands to the ai-engine - this permission is used to get the response from the command sent to the ai-engine
| cloudformation:DescribeStacks
| 
| Operate

.3+| ssm messages permissions are required to send commands to the ai-engine - this permission helps to check the ssm connection to the ai-engine
| ssm:SendCommand | Deployment | Operate
| ssm:GetConnectionStatus | Deployment | Operate
| ssm:SendCommand | Deployment | Operate

.8+| To create ai-engine instance profile during stack creation (on deploy and rebuild operations)
| iam:CreateRole | Deployment | Operate
| iam:CreateInstanceProfile | Deployment | Operate
| iam:AddRoleToInstanceProfile | Deployment | Operate
| iam:PutRolePolicy | Deployment | Operate
| iam:GetRolePolicy | Deployment | Operate
| iam:GetRole | Deployment | Operate
| iam:TagRole | Deployment | Operate
| iam:PassRole | Deployment | Operate

| In order to validate the permissions available in the role and compare with required permisisons  (on deploy and rebuild operations)
| iam:SimulatePrincipalPolicy
| Deployment
| Operate

| List security groups during ai-engine stack creation ( to find security groups on the private endpoints)
| cloudformation:DescribeStacks
| Deployment
| Operate







.4+| Get details for EC2 instances 
| ec2:DescribeInstances | Inventory (Detection) and explore savings | Operate
| ec2:DescribeKeyPairs | Deployment | Operate
| ec2:DescribeNetworkInterfaces | Deployment | Operate
| ec2:DescribeInstanceTypes | Deployment and explore savings | Operate

.6+| Get details to fill in the FSx for ONTAP deployment form
| ec2:DescribeVpcs | Deployment and Inventory (Detection) | Operate
| ec2:DescribeSubnets | Deployment and Inventory (Detection) | Operate
| ec2:DescribeSecurityGroups | Deployment | Operate
| ec2:DescribeImages | Deployment | 
| ec2:DescribeRegions | Deployment | Operate
| ec2:DescribeRouteTables | Deployment and Inventory (Detection) | Operate

|===
====

=== Permissions for VMware workloads

No input

== Change log

As permissions are added and removed, we'll note them in the sections below.
//Example: 
//=== 9 May 2024

//The following permissions is now required for Cloud Volumes ONTAP:

//ec2:DescribeAvailabilityZones
